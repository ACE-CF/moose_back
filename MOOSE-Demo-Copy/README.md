# MOOSE-Demo

**MOOSE-Demo** provides a user-friendly interface for running the [MOOSE-Chem (MC)] and [MOOSE-Chem2 (MC2)] pipelines, enabling AI-assisted scientific hypothesis generation and evaluation. It is designed for researchers seeking to explore novel hypotheses in domains such as chemistry, materials science, and beyond.

---

## Getting Started

### Step 0: Clone the Repository and Set Up the Environment

First, clone the repository along with its submodules (`MC` and `MC2`), create a Conda environment, and install the required dependencies.

```bash
git clone --recurse-submodules https://github.com/ZonglinY/MOOSE-Demo.git
cd MOOSE-Demo

# Create and activate a Conda environment
conda create -n msc python=3.10
conda activate msc

# Install dependencies for MOOSE-Chem2
pip install -r external/MC2/requirements.txt
```


#### Initialize the `MooseDemo` Object in Python

```python
import demo_utils as utils
from MooseDemo import MooseDemo

# api_type: 0 (openai) or 1 (azure)
# api_key / base_url: input from user
# model_name: input from user
job_name = "your_job_name"  # e.g., "baseline_MC"; use a unique name to avoid overwriting results
moose_demo = MooseDemo(api_type, api_key, base_url, model_name, job_name)
```

---

## Running the MOOSE-Chem (MC) Pipeline

The MC pipeline consists of three stages: **inspiration retrieval**, **hypothesis composition**, and **hypothesis ranking**.

---

### Step 1: Provide a Research Question and Background Survey

```python
research_question = "your research question"
background_survey = "your literature survey"
moose_demo.write_MC_start_file_research_background(research_question, background_survey)
```

---

### Step 2: Provide a Custom Inspiration Corpus

Prepare a directory of Excel files (your inspiration corpus), then provide its path:

```python
raw_insp_xlsx_dir = "path/to/your/excel/files"
moose_demo.write_MC_start_file_inspiration_corpus(raw_insp_xlsx_dir)
```

---

### Step 3: Run Inspiration Retrieval

```python
which_stage = [1, 0, 0]  # [inspiration, composition, ranking]
moose_demo.run_MC(which_stage)
```

---

### Step 4: Run Hypothesis Composition

```python
which_stage = [0, 1, 0]
moose_demo.run_MC(which_stage)
```

---

### Step 5: Run Hypothesis Ranking

```python
which_stage = [0, 0, 1]
moose_demo.run_MC(which_stage)
```

---

## Running the MOOSE-Chem2 (MC2) Pipeline

MC2 builds upon a selected hypothesis and aims to refine it into a more detailed, testable formulation.

---

### Step 1: Provide Research Question, Background Survey, and Coarse Hypothesis

```python
research_question = "your research question"
background_survey = "your literature survey"
coarse_grained_hypothesis = "a coarse hypothesis (e.g., generated by MC)"
# init_hyp_id: the id of coarse_grained_hypothesis as init input to MC2 under the same research question 
#   If the user want to use more than one MC's hypothesis to run MC2, you can use init_hyp_id to track them. 
#   e.g., the first coarse_grained_hypothesis can have init_hyp_id as 0, and the second can have init_hyp_id is 1, etc
init_hyp_id = 0
moose_demo.write_MC2_start_file(research_question, background_survey, coarse_grained_hypothesis, init_hyp_id=init_hyp_id)
```

---

### Step 2: Run the MC2 Pipeline

```python
moose_demo.run_MC2(init_hyp_id=init_hyp_id)
```

---

## Incorporating Feedback

### Into MOOSE-Chem (MC)

```python
selected_gene_hyp = "previously generated hypothesis"
feedback = "expert feedback on the hypothesis"

feedback_text_to_append = utils.obtain_selected_hyp_and_feedback_text(selected_gene_hyp, feedback)
moose_demo.append_new_content_to_background_survey_in_start_file_MC(feedback_text_to_append)
```

Then rerun all stages with the updated context:

```python
which_stage = [1, 1, 1]
moose_demo.run_MC(which_stage)
```

---

### Into MOOSE-Chem2 (MC2)

```python
selected_gene_hyp = "previously generated hypothesis"
feedback = "expert feedback on the hypothesis"

feedback_text_to_append = utils.obtain_selected_hyp_and_feedback_text(selected_gene_hyp, feedback)
moose_demo.append_new_content_to_background_survey_in_start_file_MC2(feedback_text_to_append, init_hyp_id=init_hyp_id)
```

Then rerun MC2 with the updated context:

```python
moose_demo.run_MC2(init_hyp_id=init_hyp_id)
```

---

## Loading Hypotheses

### Load MC Hypotheses

```python
# Returns: [[hypothesis, score, scores_list, num_rounds], ...]
gene_hyp_list = utils.load_MC_gene_hypothesis(job_name, model_name=model_name) 
```

---

### Load MC2 Hypotheses

```python
# Returns: [hypothesis, ...]
gene_hyp_list = utils.load_MC2_gene_hypothesis(job_name, model_name=model_name, eval_model_name=model_name, init_hyp_id=init_hyp_id) 
```
